<?php$notype=1;$nocount=1;require('../../../init.php');if(empty($versehighlightcolor)){$versehighlightcolor="blue";}header("Content-Type: text/xml");echo'<?xml version="1.0" encoding="utf-8" ?><results>';    $input = $_GET['input'];    $input=urldecode($input);    #$len = strlen($input);    #$letters = preg_replace("/[^a-z0-9 ]/si","",$letters); ?    if(!isset($limc)){$limc=50;}    if(isset($_GET['b'])){$biblex=$_GET['b'];}    else{$biblex=1;}    $cmode=$_GET['m'];    if($_GET['tri']==1){$dotri=1;}    //elseif(isset($_GET['bible'])){$biblex=$_GET['bible'];}    #$input=iconv('utf-8','cp1251',$input);    #if($uid==1){echo'<rs>'.($input).'</rs>';}    $characterEncoding=mb_detect_encoding($input,'UTF-8, UTF-16, ISO-8859-1, ISO-8859-15, ISO8859-5, Windows-1252, Windows-1251, ASCII ,cp1251 ,KOI8-R, UTF-16BE');    switch($characterEncoding) {    case'UTF-8':break;    case'ISO-8859-1':$input=utf8_encode($input);break;    case'ASCII':$input=utf8_encode($input);break;    default:$input=mb_convert_encoding($input,'UTF-8',$characterEncoding);break;    }# if($uid==1){echo'<rs>'.($input).'</rs>';}        $input2=$input;    if(!empty($cmode)and($cmode!==0)and($cmode!='p')){	$match[2]=$cmode;$se4=$cmode.': '.$input;require('../../../inc/advanced_search.php');	$inputt=explode(' ',$input);	$input="";$i=1;$it=count($inputt);	if(isset($dotri)){$whatcont='tx';}else{$whatcont='context';}	foreach($inputt as $inputting){	    if($i!==$it){$input.='\'%'.$inputting.'%\' AND '.$whatcont.' like ';}	    else{$input.='\'%'.$inputting.'%\'';}	    ++$i;	}    }else{$input='\'%'.$input.'%\'';}    #if($uid==1){echo'<rs>SELECT * FROM bible_context WHERE context like '.$input.' and bid=\''.$biblex.'\' Limit 0,'.$limc.'</rs>';}#.'</results>'    if(isset($dotri)){$sql='SELECT * FROM bible_tri_context WHERE tx like '.$input.' and bid='.$biblex;}    else{$sql='SELECT * FROM bible_context WHERE context like '.$input.' and bid='.$biblex;}    //if($biblex==52){$sql=utf8_encode($sql);}    $res=mysql_query_s($sql.' Limit 0,'.$limc);$num_mydata=mysql_numrows($res);    #if($uid==1){echo '<rs>'.htmlspecialchars($sql).'</rs><rs>'.htmlentities(htmlspecialchars(utf8_encode($sr))).' num:'.$num_mydata.' lim:'.$limc.'</rs>';}    #echo "1###select ID,countryName from ajax_countries where countryName like '".$letters."'|";    if($num_mydata<50){$limc=$num_mydata;}    $i=0;while($i<$limc){	 if(isset($dotri)){if($biblex==521){$context=htmlspecialchars(utf8_encode(mysql_result($res,$i,'tx')));}			    else{$context=htmlspecialchars(mysql_result($res,$i,'tx'));$thecon='tx';}	  $bkref=mysql_result($res,$i,'bk').' '.mysql_result($res,$i,'c').':'.mysql_result($res,$i,'v').'-'.mysql_result($res,$i,'ec').':'.mysql_result($res,$i,'ev');}	 else{$thecon='context';if($biblex==521){$context=htmlspecialchars(utf8_encode(mysql_result($res,$i,'context')));}			    else{$context=htmlspecialchars(mysql_result($res,$i,'context'));}	  $bkref=mysql_result($res,$i,'book').' '.mysql_result($res,$i,'chapter').':'.mysql_result($res,$i,'verse');}	#$context=str_replace($input2,'<font color="'.$versehighlightcolor.'">'.$input2.'</font>',$context); #need some fix	$context=str_ireplace($input2,'→'.$input2.'←',$context);	#$context=str_ireplace($input2,'<zx>'.$input2.'</zx>',$context);	if(!empty($sr)){	  #if(($biblex==52)){$sr=utf8_encode($sr);}	  if(preg_match('/'.$sr.'/i',mysql_result($res,$i,$thecon))){echo'<rs>'.$context.' .'.$bkref.'</rs>';}	  #if($uid==1){echo$sr;}#if($uid==1){echo'<rs>'.$context."</rs>";}	}else{echo'<rs>'.$context.' '.$bkref.'</rs>';}        ++$i;    }    echo'</results>';?>